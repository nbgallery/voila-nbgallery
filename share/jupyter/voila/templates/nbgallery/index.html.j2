{%- extends 'material/index.html.j2' -%}

{% set nbgallery = nb.metadata.get('gallery', {}) %}
{% set title = nbgallery.get('title', resources.get('metadata', {}).get('name', 'Untitled')) %}
{% set author = nbgallery.get('author', 'Unknown') %}
{% set description = nbgallery.get('description', 'No description') %}
{% set url = nbgallery.get('gallery_url', '') %}

{%- block html_head_css -%}
{{ super() }}
{{ resources.include_css("static/font-awesome-4.7.0/css/font-awesome.min.css") }}

<style type="text/css">
  /* override materialize with widget color (for qgrid's buttons) */
  .btn {
    color: var(--jp-ui-font-color1);
    background-color: var(--jp-layout-color2);
  }

  /* make password inputs look like text inputs */
  input[type=password]:not(.browser-default):disabled, input[type=password]:not(.browser-default) {
    height: var(--jp-widgets-inline-height);
    line-height: var(--jp-widgets-inline-height);
    font-size: var(--jp-widgets-font-size);
    padding: var(--jp-widgets-input-padding) calc( var(--jp-widgets-input-padding) * 2);
    border: var(--jp-widgets-input-border-width) solid var(--jp-widgets-input-border-color);
    background-color: var(--jp-widgets-input-background-color);
    color: var(--jp-widgets-input-color);
    font-size: var(--jp-widgets-font-size);
    box-sizing: border-box;
  }

  /* tweaking the navbar */
  .navbar-fixed {
    z-index: 10000;
  }

  .nav-wrapper {
    padding-left: 20px;
  }

  /* no additional margin or max width */
  .container {
    margin-left: 0px;
    margin-right: 0px;
    max-width: none;
  }

  /* undo the voila-material values (it blocks our dropdown) */
  .brand-logo {
    height: auto;
    width: auto;
  }

</style>
{%- endblock html_head_css -%}

{%- block body_header -%}
  {{ super.super() }}

  <header>

    <div id="notebook-info" class="card blue-grey darken-3 dropdown-content">
      <div style="line-height: 1.25;" class="card-content">
        <span class="card-title">{{ title }}</span>
        <p>Author: {{ author }}</p>
        <blockquote>{{ description }}</blockquote>
        <div class="card-action">
          <a target="_blank" href="{{ url }}">View in nbgallery</a>
        </div>
      </div>
    </div>

    <div class="navbar-fixed">
      <nav class="top-nav">
        <div class="nav-wrapper blue-grey darken-4">
          <a href="#" class="brand-logo">{{ title }}</a>
          <ul class="right">
            <li><a class="dropdown-trigger" href="#!" data-target="notebook-info">&nbsp;<i class="material-icons right">info_outline</i></a></li>
            <li><a href="#"><i class="material-icons" id="kernel-status-icon">radio_button_unchecked</i></a></li>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="row">
        <div class="col s12">
{%- endblock body_header -%}


{% block footer_js %}
{{ super.super() }}

<script>

// qgrid workaround
define("base/js/dialog", [], () => {});

// activate navbar dropdown
document.addEventListener('DOMContentLoaded', function() {
  elems = document.querySelectorAll('.dropdown-trigger');
  instances = M.Dropdown.init(elems, {constrainWidth: false, coverTrigger: false});
});

</script>

<!-- copied from voila-material with added workaround for widget issue -->
<!-- https://github.com/voila-dashboards/voila-material/issues/22 -->
  <script type="text/javascript">
    requirejs(['static/voila'], function(voila) {
      (async function() {
        var kernel = await voila.connectKernel();

        // Don't try to handle comm messages
        kernel.registerCommTarget = () => {};
        kernel.removeCommTarget = () => {};
        kernel._handleCommOpen = () => {};
        kernel._handleCommClose = () => {};
        kernel._handleCommMsg = () => {};

        kernel.statusChanged.connect(() => {
          // console.log(kernel.status);
          var el = document.getElementById("kernel-status-icon");

          if (kernel.status == 'busy') {
            el.innerHTML = 'radio_button_checked';
          } else {
            el.innerHTML = 'radio_button_unchecked';
          }
        });
      })();
    });
  </script>
{% endblock footer_js %}

